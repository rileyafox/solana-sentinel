syntax = "proto3";
package sentinel.v1;

option go_package = "solana-sentinel/api/v1;apiv1";

import "google/api/annotations.proto";

message AccountRef { string pubkey = 1; }
message ProgramRef { string program_id = 1; }
message SlotRange  { uint64 start = 1; uint64 end = 2; }

message TxSummary {
  string signature = 1;
  uint64 slot = 2;
  string err = 3;
  int64  fee = 4;
  int64  block_time_unix = 5;
}

message Event {
  string id = 1;
  string kind = 2;
  string signature = 3;
  uint64 slot = 4;
  string account = 5;
  string program = 6;
  string amount = 7;
  string mint = 8;
  string raw_json = 9;
  int64  occurred_at_unix = 10;
}

message GetTxsRequest {
  oneof scope {
    AccountRef account = 1; // query: account.pubkey=...
    ProgramRef program = 2; // query: program.program_id=...
  }
  SlotRange slots = 3;      // query: slots.start=..&slots.end=..
  uint32 limit = 4;         // query: limit=
}

message GetTxsResponse { repeated TxSummary txs = 1; }

message StreamEventsRequest {
  oneof scope {
    AccountRef account = 1;
    ProgramRef program = 2;
  }
  string filter_kind = 3;
}

service SentinelService {
  rpc GetTransactions(GetTxsRequest) returns (GetTxsResponse) {
    option (google.api.http) = {
      get: "/v1/transactions"
    };
  }

  // grpc-gateway will stream this back as chunked JSON
  rpc StreamEvents(StreamEventsRequest) returns (stream Event) {
    option (google.api.http) = {
      get: "/v1/stream/events"
    };
  }
}
